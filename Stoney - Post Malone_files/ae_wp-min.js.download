function AEJSReady(e){if(AEJSWP.debugOutput("AEJSReady fired"),"undefined"!=typeof AEJSWP.ae_framework_reloaded)return AEJSWP.debugOutput("But not re-running AEJSReady init as this is a framework reload, instead starting auth flow with provider = "+AEJSWP.auth_service_after_reload),void AEJSWP.aeJS.trigger.authenticate(AEJSWP.auth_service_after_reload,"register");if(AEJSWP.aeJS=e,e.events.onFlow.addHandler(AEJSWP.flowHandler),e.events.onLogin.addHandler(AEJSWP.loginHandler),e.events.onLogout.addHandler(AEJSWP.logoutHandler),e.events.onUser.addHandler(AEJSWP.userHandler),e.events.onWindow.addHandler(AEJSWP.windowHandler),e.events.onMobileDetect.addHandler(AEJSWP.mobileDetectHandler),e.events.onEmailVerify.addHandler(AEJSWP.emailVerifyHandler),e.events.onPasswordReset.addHandler(AEJSWP.passwordResetHandler),"detect"==AEJSWP.flow_type?(e.settings.mobile_detect=!0,e.settings.auth_window=!0):e.settings.auth_window="modal"==AEJSWP.flow_type,e.settings.extra_fields_screen=AEJSWP.extra_fields_screen,e.settings.extra_fields=AEJSWP.extra_fields,e.settings.minimum_age=AEJSWP.minimum_age?AEJSWP.minimum_age:null,e.settings.services=AEJSWP.services,e.settings.flow_css=""!=AEJSWP.flow_css?AEJSWP.flow_css:null,e.settings.verify_email=!!AEJSWP.verify_email,e.settings.verify_email_for_login=!!AEJSWP.verify_email,e.settings.flow_text=AEJSWP.flow_text,e.settings.no_email=!!AEJSWP.no_email,e.settings.hide_email_form=!!AEJSWP.hide_email_form,e.settings.social_first=!!AEJSWP.social_first,e.settings.return_url=AEJSWP.return_url,e.settings.email_format=AEJSWP.email_format,e.settings.date_format=AEJSWP.date_format,e.settings.sso=AEJSWP.sso_type,""!=AEJSWP.extra_info&&(e.settings.extra_info=AEJSWP.extra_info),"undefined"!=typeof AEJSWP.validation_target&&""!=AEJSWP.validation_target)if("widget"!=AEJSWP.validation_target){var t=parseInt(AEJSWP.validation_target.replace("cform-",""));AEJSWP.debugOutput("Validation Target is custom form "+t),AEJSWP.applyCustomFormSettings(t)}else AEJSWP.debugOutput("Validation Target is widget");else AEJSWP.debugOutput("Validation Target not defined, assuming widget"),"widget"==AEJSWP.validation_target;AEJSWP.user_logging_in=!1,AEJSWP.ae_login_fired=!1,AEJSWP.custom_form_complete=!1,AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed")||AEJSWP.setLocalStorageItem("aeswp_cform_mailing_lists_completed",[],!0);var r=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);AEJSWP.getLocalStorageItem("aejswp_optin_choices")?AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)||AEJSWP.setSessionStorageItem("aejswp_initial_optin_choices",r,!0):AEJSWP.setLocalStorageItem("aejswp_optin_choices",[],!0),AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)||AEJSWP.setSessionStorageItem("aejswp_initial_optin_choices",[],!0),AEJSWP.debugOutput("",AEJSWP),AEJSWP.debugOutput("AEJSReady: ",e),AEJSWP.getSessionStorageItem("aejswp_cform_id")&&(AEJSWP.debugOutput("Custom Form flow still in progress"),AEJSWP.applyCustomFormSettings(AEJSWP.getSessionStorageItem("aejswp_cform_id")));for(var o=0;o<AEJSWP.aejsready_handlers.length;o++)AEJSWP.debugOutput("Calling custom aejsready_handler : "+AEJSWP.aejsready_handlers[o]),AEJSWP.executeFunctionByName(AEJSWP.aejsready_handlers[o],window,e)}jQuery(document).ready(function(){AEJSWP.redirectFlowSigninErrorCheck(),AEJSWP.addAuthenticatorClickHandler(),"undefined"!=typeof AEJSWP.aeJS&&AEJSWP.authConnect(AEJSWP.aeJS.user),AEJSWP.addCustomFormListeners(),AEJSWP.updateCustomForms()}),AEJSWP.reloadAeJSFramework=function(e){if(AEJSWP.aeJS.settings.auth_window)AEJSWP.debugOutput("Starting auth flow with provider = "+e),AEJSWP.aeJS.trigger.authenticate(e,"register");else{AEJSWP.debugOutput("Redirect flow, so re-loading aeJS framework to pick up changed settings");var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=AEJSWP.ae_js_path,t.appendChild(r),AEJSWP.ae_framework_reloaded=!0,AEJSWP.auth_service_after_reload=e}},AEJSWP.userHandler=function(e,t){if(AEJSWP.debugOutput("userHandler: "+t,e),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("Doing nothing, password reset flow in progress");else if(("disabled"!=AEJSWP.sso_type||AEJSWP.getSessionStorageItem("aejswp_ae_login_fired"))&&"undefined"!=typeof e&&"undefined"!=typeof e.data){if(AEJSWP.onUserSSOLogin())return AEJSWP.debugOutput("onUser SSO attempt"),void AEJSWP.loginHandler(e,"login",!0);if(AEJSWP.getSessionStorageItem("aejswp_cform_id"))return void("init"!=t&&"update"!=t||AEJSWP.customFormValidation(e));AEJSWP.disable_logged_in_session&&(AEJSWP.debugOutput("Logged-in session disabled in performance settings"),AEJSWP.ajaxUpdateState(e)),AEJSWP.authConnect(e)}},AEJSWP.loginHandler=function(e,t,r){if(AEJSWP.debugOutput("loginHandler: "+t+" (sso="+r+")",e),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("Doing nothing, password reset flow in progress");else if(AEJSWP.setSessionStorageItem("aejswp_ae_login_fired",!0),AEJSWP.ae_login_fired=!0,"registration"==t&&AEJSWP.trackEvent("registration",e),"auth"==t&&(AEJSWP.trackEvent("accountConnect",e),AEJSWP.authConnect(e)),!AEJSWP.custom_form_complete){if(AEJSWP.getSessionStorageItem("aejswp_cform_id")&&("login"==t||"registration"==t))return void AEJSWP.customFormValidation(e);("login"==t||"registration"==t||"auth"==t&&!AEJSWP.user_logged_in)&&AEJSWP.logUserIn(e)}},AEJSWP.flowHandler=function(e){if(AEJSWP.debugOutput("flowHandler: ",e),"undefined"!=typeof e.step)if(AEJSWP.getSessionStorageItem("aejswp_cform_id")){AEJSWP.ae_form_submit_in_progress=!1;var t=AEJSWP.getSessionStorageItem("aejswp_cform_id");if("verify-email"==e.step&&(AEJSWP.debugOutput("User still needs to verify their email"),AEJSWP.setSessionStorageItem("aejswp_verify_email_in_progress",AEJSWP.aeJS.user.data.Email),AEJSWP.displayVerifyEmail(t,AEJSWP.aeJS.user.data.Email),AEJSWP.getSessionStorageItem("aejswp_verify_email_sent")||(AEJSWP.setSessionStorageItem("aejswp_verify_email_sent",!0),AEJSWP.sendVerifyEmail(AEJSWP.aeJS.user.data.Email))),"required-fields"==e.step)if(AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("User still in password reset flow - so not showing additional details form, they must login first");else{AEJSWP.debugOutput("User missing required fields"),AEJSWP.addAEHandlerBackToCustomForm(AEJSWP.getSessionStorageItem("aejswp_cform_id")),AEJSWP.hideCaptchaOnForm(AEJSWP.getSessionStorageItem("aejswp_cform_id")),AEJSWP.redirectToCustomFormPage(t);var r=AEJSWP.checkUserRequiredFields(t,AEJSWP.aeJS.user);AEJSWP.displayAdditionalDetailsForm(t,r),AEJSWP.updateCustomForms()}if("error"===e.step){if(e.error=e.error.replace(/\+/g," "),e.error.includes("Email account already exists with a different password")){AEJSWP.debugOutput("That user already exists - please use the login form instead");var o=jQuery("#ae-cform-email-reg-"+AEJSWP.getSessionStorageItem("aejswp_cform_id"));if(o.length&&AEJSWP.setFormError(o,AEJSWP.custom_forms[AEJSWP.getSessionStorageItem("aejswp_cform_id")].flow_labels.form_error_account_exists),!AEJSWP.aeJS.settings.auth_window){var t=AEJSWP.getSessionStorageItem("aejswp_cform_id");AEJSWP.displayRegistrationForm(t),jQuery("#ae-cform-email-container-"+t).slideToggle()}}if(e.error.includes("No account exists with those credentials")){AEJSWP.debugOutput("Incorrect email and/or password");var o=jQuery("#ae-cform-email-login-"+AEJSWP.getSessionStorageItem("aejswp_cform_id"));o.length&&AEJSWP.setFormError(o,AEJSWP.custom_forms[AEJSWP.getSessionStorageItem("aejswp_cform_id")].flow_labels.form_error_no_account),AEJSWP.aeJS.settings.auth_window||jQuery("#ae-cform-email-container-"+AEJSWP.getSessionStorageItem("aejswp_cform_id")).slideToggle()}e.error.includes("Missing required username and/or password")&&AEJSWP.debugOutput("Missing required username and/or password"),e.error.includes("authentication denied")&&AEJSWP.debugOutput("Social Auth denied"),AEJSWP.clearCustomFormState()}}else"register"==e.step&&AEJSWP.trackEvent("registrationModalShown",AEJSWP.widget_cta),"login"==e.step&&AEJSWP.trackEvent("loginModalShown",AEJSWP.widget_cta)},AEJSWP.emailVerifyHandler=function(e,t){if(AEJSWP.debugOutput("emailVerifyHandler: "+e,t),""!=AEJSWP.getQueryStringValue("password_reset")&&AEJSWP.setSessionStorageItem("aejswp_cform_id",parseInt(AEJSWP.getQueryStringValue("password_reset"))),AEJSWP.getSessionStorageItem("aejswp_cform_id")&&"undefined"!=typeof e&&("sent"==e&&AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")&&AEJSWP.displayPasswordResetEmailSent(),"verified"==e&&(AEJSWP.debugOutput("User returned after succesful email verification"),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")))){AEJSWP.debugOutput("Storing verify email return data for password reset"),AEJSWP.setSessionStorageItem("aejswp_password_reset_email",t.EmailAddress),AEJSWP.setSessionStorageItem("aejswp_password_reset_member_service_id",t.MemberServiceID),1==parseInt(AEJSWP.custom_forms[AEJSWP.getSessionStorageItem("aejswp_cform_id")].modal_display)&&AEJSWP.setSessionStorageItem("aejswp_password_reset_force_modal_open",!0);var r=AEJSWP.removeURLParameter(window.location.href,"password_reset");r=AEJSWP.removeURLParameter(r,"step"),r=AEJSWP.removeURLParameter(r,"code"),window.location.href=r}},AEJSWP.passwordResetHandler=function(e,t){AEJSWP.debugOutput("passwordResetHandler: "+e,t),AEJSWP.getSessionStorageItem("aejswp_cform_id")&&"undefined"!=typeof e&&"ok"==e&&(AEJSWP.displayPasswordResetSuccess(),AEJSWP.clearPasswordResetState())},AEJSWP.mobileDetectHandler=function(){AEJSWP.debugOutput("mobileDetectHandler fired"),AEJSWP.aeJS.settings.auth_window=!1},AEJSWP.windowHandler=function(e){AEJSWP.debugOutput("windowHandler: ",e)},AEJSWP.logoutHandler=function(e){AEJSWP.debugOutput("logoutHandler: ",e)},AEJSWP.logUserIn=function(e,t){if(t=t||!1,!AEJSWP.user_logging_in){AEJSWP.user_logging_in=!0,AEJSWP.debugOutput("User logged in to AE, performing WP plugin follow on actions..."),AEJSWP.trackEvent("login",e);var r=AEJSWP.getQueryStringValue("aewperror");if(""==r)if(AEJSWP.user_logged_in)AEJSWP.debugOutput("Doing nothing, user already logged-in");else if(AEJSWP.ajax_login){var o=t?AEJSWP.getUserOptinChoices(t):[];AEJSWP.ajaxLogin(e,o,t)}else{if(AEJSWP.disable_wp_user_record)return AEJSWP.debugOutput("WP user record disabled"),t&&AEJSWP.sendUserOptins(t,e.data,AEJSWP.getUserOptinChoices(t)),void AEJSWP.ajaxUpdateState(e);if(AEJSWP.disable_logged_in_session&&(AEJSWP.debugOutput("Logged-in session disabled"),!AEJSWP.aeJS.settings.auth_window&&!t))return void AEJSWP.debugOutput("User has already been through redirect login handler, which will have created the WP record, doing nothing");var o=t?AEJSWP.getUserOptinChoices(t):[],a=AEJSWP.getUserUpdatedOptins(t,o);if(a){var s={cform_id:t,user_data:e.data,optins:a};AEJSWP.trackEvent("optinsUpdated",s)}AEJSWP.redirectLogin(e,o,t)}else AEJSWP.debugOutput("Doing nothing, aewperror="+r+" detected in query string")}},AEJSWP.ajaxLogin=function(e,t,r){"undefined"==typeof e.services&&(e.services=[]),r=r||!1;var o=window.location.href;o=AEJSWP.removeURLParameter(o,"password_reset");var t=t||[],a={action:AEJSWP.ajax_action_login,data:e.data,services:e.services,current_page:o,optins:t,cform_id:r};AEJSWP.disable_wp_user_record?(AEJSWP.debugOutput("WP user record disabled, not making AJAX request to login"),r&&AEJSWP.sendUserOptins(r,e.data,AEJSWP.getUserOptinChoices(r)),""!=AEJSWP.login_redirect_url?(AEJSWP.debugOutput("Post login redirect specified, redirecting to: "+AEJSWP.login_redirect_url),window.location.href=AEJSWP.login_redirect_url):(AEJSWP.debugOutput("Updating state via AJAX"),AEJSWP.ajaxUpdateState(e))):(AEJSWP.debugOutput("WP Login AJAX request : ",a),jQuery.post(AEJSWP.ajaxurl,a,function(o){try{if(o=jQuery.parseJSON(o),0==o.status)6==o.fail_status&&(o.message=o.message.replace(new RegExp("<br/>","g"),"\n"),alert(o.message)),console.log("AEJSWP Error: WP Login AJAX response : ",o);else{AEJSWP.debugOutput("WP Login AJAX response : ",o);var a=AEJSWP.getUserUpdatedOptins(r,t);if(a){var s={cform_id:r,user_data:e.data,optins:a};AEJSWP.trackEvent("optinsUpdated",s)}""!=AEJSWP.login_redirect_url?(AEJSWP.debugOutput("Post login redirect specified, redirecting to: "+AEJSWP.login_redirect_url),window.location.href=AEJSWP.login_redirect_url):(AEJSWP.debugOutput("Updating state via AJAX"),AEJSWP.ajaxUpdateState(e),AEJSWP.disable_logged_in_session||(AEJSWP.debugOutput("Setting user_logged_in to true & making AJAX request to get an updated logout URL"),AEJSWP.user_logged_in=!0,AEJSWP.getLogoutURL()),AEJSWP.authConnect(e))}}catch(e){console.log("AEJSWP Error: WP Login AJAX response : ",o)}}))},AEJSWP.redirectLogin=function(e,t,r){var o=e.data.AccessToken,t=t||[],a=encodeURIComponent(JSON.stringify(t)),s=window.location.href;s=AEJSWP.removeURLParameter(s,"accessToken"),s=AEJSWP.removeURLParameter(s,"password_reset");var i=""!=AEJSWP.login_redirect_url?AEJSWP.login_redirect_url:encodeURIComponent(s),n=AEJSWP.ajaxurl+"?action="+AEJSWP.redirect_action_login+"&accessToken="+o+"&optins="+a+"&cform_id="+r+"&return_url="+i;AEJSWP.debugOutput("Redirect Login, redirecting to: "+n),window.location.href=n},AEJSWP.getLogoutURL=function(){var e={action:AEJSWP.ajax_action_get_logout_url,return_url:window.location.href};AEJSWP.debugOutput("WP get_logout_url AJAX request",e),jQuery.post(AEJSWP.ajaxurl,e,function(e){AEJSWP.debugOutput("WP get_logout_url AJAX response : ",e),e=jQuery.parseJSON(e),""!=e.wp_logout_url&&(AEJSWP.wp_logout_url=e.wp_logout_url)})},AEJSWP.onUserSSOLogin=function(){var e=AEJSWP.getSessionStorageItem("aewpjs_sso_attempted");if("disabled"!=AEJSWP.sso_type&&!AEJSWP.user_logged_in&&!e){var t=AEJSWP.getQueryStringValue("aewperror");if(""==t)return AEJSWP.setSessionStorageItem("aewpjs_sso_attempted",!0),!0;AEJSWP.debugOutput("onUser SSO login attempt failed, WP returned error: "+AEJSWP.login_fail_status_messages[t])}return!1},AEJSWP.ajaxUpdateState=function(e){"undefined"!=typeof e.data&&(AEJSWP.debugOutput("Updating logged in state without page refresh, using the aeJS user object"),AEJSWP.authConnect(e),jQuery("."+AEJSWP.ajax_update_class).each(function(t,r){var o=jQuery(this).data("aewp-no-salutation"),a=jQuery(this).data("aewp-no-profile-link"),s=jQuery(this).data("aewp-no-logout-link"),i="";o||(i+='<span class="ae-wp-salutation">',i+=AEJSWP.logged_in_salutation.replace("{USERNAME}",e.data.Username),i+="</span>"),a||(i+='<span class="ae-wp-profile-link">',i+='<a href="'+AEJSWP.profile_link_url+'">'+AEJSWP.profile_link.replace("{USERNAME}",e.data.Username)+"</a>",i+="</span>"),s||(i+='<span class="ae-wp-logout-link">',i+='<a class="ae-wp-logout-anchor" href="#" onclick="AEJSWP.logout();">'+AEJSWP.logout_link+"</a>",i+="</span>"),jQuery(this).html(i)}))},AEJSWP.redirectFlowSigninErrorCheck=function(){var e=AEJSWP.getQueryStringValue("aewperror");if(6==e){var t=!1;if("undefined"!=typeof Storage&&AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")&&(t=AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")),!t){"undefined"!=typeof Storage&&(t=AEJSWP.setSessionStorageItem("aewpjs_login_error_status_6_displayed",!0),sso_attempted=AEJSWP.setSessionStorageItem("aewpjs_sso_attempted",!0));var r=AEJSWP.login_fail_status_messages[6].replace(new RegExp("<br/>","g"),"\n");alert(r)}}},AEJSWP.authConnect=function(e){"undefined"!=typeof e&&"undefined"!=typeof e.data&&(AEJSWP.debugOutput("Updating Auth Connect anchors: ",e),jQuery(".ae-wp-auth-connect-container").each(function(t,r){var o=jQuery(".ae-wp-authenticator-anchor",jQuery(this)),a=o.attr("data-ae-register-link"),s=o.attr("data-ae-login-link"),i=o.attr("ae-wp-connect-provider"),n=null,u="";if("undefined"!=typeof a&&a!==!1?(n=a,u="data-ae-register-link"):"undefined"!=typeof s&&s!==!1?(n=s,u="data-ae-login-link"):"undefined"!=typeof i&&i!==!1&&(n=i),n)if(AEJSWP.providerExistsInServices(e.services,n)){if(jQuery(this).trigger("ae-wp-auth-connected"),jQuery(this).addClass("ae-wp-auth-connected"),AEJSWP.auth_connected.length>0){var d='<span class="ae-wp-auth-connected-message">';d+=AEJSWP.auth_connected,d+="</span>",jQuery(this).html(d)}}else""!==u&&(o.removeAttr(u),o.attr("ae-wp-connect-provider",n))}))},AEJSWP.addAuthenticatorClickHandler=function(){jQuery(".ae-wp-authenticator-anchor").click(function(e){e.preventDefault();var t=AEJSWP.aeJS.settings.return_url,r=jQuery(this).hasClass("ae-disabled-login-hook");r&&(t+="&disable-login-hook=true",AEJSWP.aeJS.settings.return_url=t,AEJSWP.login_redirect_url=t,AEJSWP.debugOutput("AE Auth Connect Triggered. Login hook has been disabled. Return URL:",t));var o=jQuery(this).attr("ae-wp-connect-provider");"undefined"!=typeof o&&o!==!1?(t+="&auth-connect=true",AEJSWP.debugOutput("AE Auth Connect Triggered. Return URL:",t),AEJSWP.aeJS.settings.return_url=t,AEJSWP.aeJS.trigger.authenticate(o,"auth")):(o=jQuery(this).attr("ae-wp-provider"),"undefined"==typeof o&&(o=jQuery(this).attr("data-ae-register-link")),"undefined"==typeof o&&(o=jQuery(this).attr("data-ae-login-link")),AEJSWP.aeJS.trigger.authenticate(o,"auth"))})},AEJSWP.trackEvent=function(e,t){switch(e){case"loginModalShown":AEJSWP.debugOutput("Firing loginModalShown event with data: ",String(t)),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".loginModalShown",window,String(t));break;case"registrationModalShown":AEJSWP.debugOutput("Firing registrationModalShown event with data: ",String(t)),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".registrationModalShown",window,String(t));break;case"login":var r=t,o=AEJSWP.getLastLoginService(r.services),a={service_name:o.Service,service_user_id:o.ID,ae_user_id:r.data.ID,ae_user_data:r};AEJSWP.debugOutput("Firing login event with data: ",a),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".login",window,a);break;case"registration":var r=t,o=AEJSWP.getLastLoginService(r.services),a={service_name:o.Service,service_user_id:o.ID,ae_user_id:r.data.ID,ae_user_data:r};AEJSWP.debugOutput("Firing registration event with data: ",a),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".registration",window,a);break;case"formErrors":AEJSWP.debugOutput("Firing formErrors event with data: ",t),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".formErrors",window,t);break;case"accountConnect":var r=t,o=AEJSWP.getLastLoginService(r.services),a={service_name:o.Service,service_user_id:o.ID,ae_user_id:r.data.ID,ae_user_data:r};AEJSWP.debugOutput("Firing accountConnect event with data: ",a),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".accountConnect",window,a);break;case"optinsUpdated":AEJSWP.debugOutput("Firing optinsUpdated event with data: ",t),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".optinsUpdated",window,t)}},AEJSWP.fireFormErrorsEvent=function(e,t){"registration"!=e&&"login"!=e&&"mailinglist"!=e&&(e="login");var r={};r.form_errors=t,r.form_type=e,AEJSWP.trackEvent("formErrors",r)},AEJSWP.customFormSubmit=function(e,t){AEJSWP.debugOutput("User submitted custom form "+e);var r=parseInt(AEJSWP.custom_forms[e].type_id);AEJSWP.applyCustomFormSettings(e);var o=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[],a=(o[e],1==o[e]),s=AEJSWP.getSessionStorageItem("aejswp_user_casl_in_progress")==e;if("undefined"!=typeof t&&!a&&s&&(AEJSWP.debugOutput("User completed CASL compliance flow, updating state"),o[e]=!0,AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress"),AEJSWP.setLocalStorageItem("aejswp_user_casl_completed",o,!0)),"undefined"!=typeof t&&2==r&&"undefined"==typeof AEJSWP.aeJS.user.data&&(AEJSWP.debugOutput("Mailing list form submission click without an AE user"),t.preventDefault(),AEJSWP.mailingListFormValidation(e)),"undefined"!=typeof t&&1==r){AEJSWP.debugOutput("Registration form - running parsley validation");var i=jQuery(t.target).parents("form");if(i.parsley().validate(),jQuery(".parsley-error",i).length){AEJSWP.debugOutput("Parsley errors - registration form not yet complete, preventing AE submit"),t.preventDefault();var n=[];return jQuery(".parsley-errors-list li",i).each(function(){var e=jQuery(this)[0].innerHTML;n.push(e)}),void AEJSWP.fireFormErrorsEvent("registration",n)}if(AEJSWP.debugOutput("No parsley errors"),!AEJSWP.minimumAgeCheck(e))return void t.preventDefault();if("undefined"!=typeof AEJSWP.custom_forms[e].form_fields.captcha)if(AEJSWP.debugOutput("Registration form has a captcha."),"undefined"!=typeof AEJSWP.aeJS.user.data)AEJSWP.debugOutput("Authenticated user session found, captcha check not applied");else{if(!AEJSWP.custom_forms[e].captchaVerified)return AEJSWP.debugOutput("Registration form captcha not validated, preventing AE submit"),t.preventDefault(),AEJSWP.setFormError(i,AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete),void AEJSWP.fireFormErrorsEvent("registration",[AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete]);AEJSWP.debugOutput("Form captcha validated"),AEJSWP.hideFormError(i)}else AEJSWP.debugOutput("No captcha on form");t.preventDefault(),"undefined"==typeof AEJSWP.ae_form_submit_in_progress||0==AEJSWP.ae_form_submit_in_progress?(AEJSWP.ae_form_submit_in_progress=!0,AEJSWP.debugOutput("Submitting form to AE"),AEJSWP.aeJS.trigger.submit(t.target.form)):AEJSWP.debugOutput("Stopping form submit as user has previously clicked the submit button, still waiting on response from AE")}},AEJSWP.applyCustomFormSettings=function(e,t){var r=parseInt(AEJSWP.custom_forms[e].type_id);AEJSWP.debugOutput("Applying Custom Form settings for cform_id = "+e+", cform_type_id = "+r),AEJSWP.setSessionStorageItem("aejswp_cform_id",e),AEJSWP.setSessionStorageItem("aejswp_cform_prev_return_url")||(AEJSWP.setSessionStorageItem("aejswp_cform_prev_return_url",AEJSWP.aeJS.settings.return_url),AEJSWP.setSessionStorageItem("aejswp_cform_prev_auth_window",AEJSWP.aeJS.settings.auth_window),AEJSWP.setSessionStorageItem("aejswp_cform_prev_extra_fields",AEJSWP.aeJS.settings.extra_fields,!0)),AEJSWP.aeJS.settings.display_error_message=!1,AEJSWP.aeJS.settings.extra_fields_screen=!1,AEJSWP.aeJS.settings.verify_email=!1,0==AEJSWP.aeJS.settings.auth_window&&(AEJSWP.aeJS.settings.return_url=""!=AEJSWP.custom_forms[e].page_url?AEJSWP.custom_forms[e].page_url:window.location.href);var o="",a=AEJSWP.custom_forms[e].signin_options;for(var s in a)""!=a[s]["ae-service"]&&(o+=a[s]["ae-service"]+",");o=o.replace(/,\s*$/,""),AEJSWP.aeJS.settings.services=o,AEJSWP.aeJS.settings.extra_fields={};for(var s in AEJSWP.custom_forms[e].form_fields)"password"!=s&&"captcha"!=s&&(AEJSWP.aeJS.settings.extra_fields[s]={label:s,required:!0});AEJSWP.debugOutput("Modified aeJS",AEJSWP.aeJS.settings),"undefined"!=typeof t&&(t.preventDefault(),"undefined"==typeof AEJSWP.ae_form_submit_in_progress||0==AEJSWP.ae_form_submit_in_progress?(AEJSWP.ae_form_submit_in_progress=!0,AEJSWP.debugOutput("Submitting form to AE"),AEJSWP.aeJS.trigger.submit(t.target.form)):AEJSWP.debugOutput("Stopping form submit as user has previously clicked the submit button, still waiting on response from AE"))},AEJSWP.customFormValidation=function(e){AEJSWP.debugOutput("Custom form validation");var t=AEJSWP.getSessionStorageItem("aejswp_cform_id"),r=AEJSWP.checkUserRequiredFields(t,e);if(r.length>0)return AEJSWP.ae_login_fired&&(AEJSWP.ae_login_fired=!1,AEJSWP.redirectToCustomFormPage(t)),void AEJSWP.displayAdditionalDetailsForm(t,r);if(AEJSWP.verify_email&&!AEJSWP.userHasVerifiedEmail())return AEJSWP.debugOutput("Verified Email required, but missing"),AEJSWP.setSessionStorageItem("aejswp_verify_email_in_progress",e.data.Email),AEJSWP.displayVerifyEmail(t,e.data.Email),void AEJSWP.sendVerifyEmail(e.data.Email);switch(AEJSWP.custom_form_complete=!0,1==parseInt(AEJSWP.custom_forms[t].modal_display)&&jQuery.modal.close(),AEJSWP.clearCustomFormState(!0),parseInt(AEJSWP.custom_forms[t].type_id)){case 1:AEJSWP.debugOutput("Finished registration custom form"),AEJSWP.logUserIn(e,t);break;case 2:AEJSWP.debugOutput("Finished mailing list custom form"),AEJSWP.mailingListFormComplete(t,e.data)}},AEJSWP.checkUserRequiredFields=function(e,t){AEJSWP.debugOutput("Checking user record for required fields on cform "+e);var r=[],o=AEJSWP.custom_forms[e].form_fields;for(var a in o){var s=o[a];if("password"!=a&&"captcha"!=a)if("undefined"==typeof t.data[s]||""==t.data[s]||null==t.data[s]||"Unknown"==t.data[s])r.push(a);else if("country"==a){var i="1"==AEJSWP.custom_forms[e].opt_ins_casl_enabled,n=0!=Object.keys(AEJSWP.custom_forms[e].opt_ins).length,u="undefined"!=typeof t.data.CountryCode&&"CA"==t.data.CountryCode||"undefined"!=typeof t.data.Country&&"Canada"==t.data.Country||"undefined"!=typeof t.data.GeoCountry&&"CA"==t.data.GeoCountry,d=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[],S=(d[e],1==d[e]);i&&n&&u&&!S&&(AEJSWP.debugOutput("User is from Canada and has not yet completed CASL flow - forcibly adding country to missing fields & updating opt-ins for CASL compliance"),r.push("country"),AEJSWP.updateCaslLabels(!0),AEJSWP.setSessionStorageItem("aejswp_user_casl_in_progress",e))}else"birthdate"==a&&(AEJSWP.minimumAgeCheck(e)||r.push(a))}return r.length>0&&AEJSWP.debugOutput("User is missing fields: "+r),r},AEJSWP.minimumAgeCheck=function(e){if(AEJSWP.minimum_age){AEJSWP.debugOutput("Minimum age of "+AEJSWP.minimum_age+" required");var t=jQuery("#ae-cform-input-reg-birthdate-"+e).val();"undefined"!=typeof t&&""!=t&&"undefined"!=t&&parseInt(t)===parseInt(t)||(AEJSWP.debugOutput("no dob field on form, using dob from user record"),t="undefined"!=typeof AEJSWP.aeJS.user.data&&"undefined"!=typeof AEJSWP.aeJS.user.data.BirthDate?AEJSWP.aeJS.user.data.BirthDate:new Date),t=new Date(t);var r=new Date,o=Math.floor((r-t)/31536e6);if(AEJSWP.debugOutput("User is "+o),o<=AEJSWP.minimum_age){AEJSWP.debugOutput("User is not old enough");var a=AEJSWP.custom_forms[e].flow_labels.form_error_age_check_fail;a=a.replace("{AGE}",AEJSWP.minimum_age);var s=jQuery("#ae-cform-email-reg-"+e);return AEJSWP.setFormError(s,a),1==parseInt(AEJSWP.custom_forms[e].type_id)?AEJSWP.fireFormErrorsEvent("registration",[a]):AEJSWP.fireFormErrorsEvent("mailinglist",[a]),!1}}return!0},AEJSWP.displayAdditionalDetailsForm=function(e,t){AEJSWP.debugOutput("Displaying additional details form");var r=AEJSWP.custom_forms[e].form_fields;for(var o in r){var a=o;t.indexOf(a)==-1&&(jQuery("#ae-cform-reg-item-"+a+"-"+e).remove(),"password"==a&&jQuery("#ae-cform-reg-item-password-confirm-"+e).remove())}AEJSWP.updateCustomForms(),jQuery("#ae-cform-title-"+e).html(AEJSWP.custom_forms[e].flow_labels.additional_info_title),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-email-container-"+e).show(),jQuery("#ae-cform-email-reg-container-"+e).show(),jQuery("#ae-cform-email-login-container-"+e).hide(),jQuery("#ae-cform-already-registered-link-"+e).hide()},AEJSWP.redirectToCustomFormPage=function(e){var t=AEJSWP.custom_forms[e].page_url;return""!=t&&window.location.href.indexOf(t)==-1&&(AEJSWP.debugOutput("Redirecting user to custom form page: "+t),window.location.href=t,!0)},AEJSWP.mailingListFormValidation=function(e){AEJSWP.debugOutput("Mailing list form submit");var t=jQuery("#ae-cform-email-reg-"+e),r=AEJSWP.custom_forms[e].form_fields,o=!0;for(var a in r)if("password"!=a&&"captcha"!=a){var s=jQuery("#ae-cform-reg-item-"+a+"-"+e+" :input").val();AEJSWP.debugOutput(a+" = "+s),""==s&&(o=!1)}if(AEJSWP.minimumAgeCheck(e)){if("undefined"!=typeof AEJSWP.custom_forms[e].form_fields.captcha){if(AEJSWP.debugOutput("Email form has a captcha."),!AEJSWP.custom_forms[e].captchaVerified)return AEJSWP.debugOutput("Captcha not complete / validated."),AEJSWP.setFormError(t,AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete),void AEJSWP.fireFormErrorsEvent("mailinglist",[AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete]);AEJSWP.debugOutput("Captcha complete.")}if(o){AEJSWP.debugOutput("Mailing List Form complete, next steps...");var i=AEJSWP.getNonAEUserDetails(e);AEJSWP.mailingListFormComplete(e,i)}else AEJSWP.debugOutput("Mailing List Form incomplete"),AEJSWP.setFormError(t,AEJSWP.custom_forms[e].flow_labels.form_error_incomplete),AEJSWP.fireFormErrorsEvent("mailinglist",[AEJSWP.custom_forms[e].flow_labels.form_error_incomplete])}},AEJSWP.getNonAEUserDetails=function(e){var t={},r=AEJSWP.custom_forms[e].form_fields;for(var o in r)if("password"!=o&&"captcha"!=o){var a=jQuery("#ae-cform-reg-item-"+o+"-"+e+" :input").val(),s=r[o];t[s]=a}return AEJSWP.debugOutput("Non AE User data",t),t},AEJSWP.mailingListFormComplete=function(e,t){AEJSWP.debugOutput("Mailing list completed, cform_id = "+e);var r=AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0);r.push(e),AEJSWP.setLocalStorageItem("aeswp_cform_mailing_lists_completed",r,!0);var o=AEJSWP.getUserOptinChoices(e);AEJSWP.sendUserOptins(e,t,o),AEJSWP.displayMailingListSuccess(e)},AEJSWP.displayMailingListSuccess=function(e){AEJSWP.debugOutput("Mailing list form "+e+" completed"),jQuery("#ae-cform-container-"+e).html(jQuery("#ae-cform-mailing-list-success-"+e).html()),1==parseInt(AEJSWP.custom_forms[e].modal_display)&&jQuery.modal.close()},AEJSWP.addAEHandlerBackToCustomForm=function(e){"undefined"!=typeof AEJSWP.aeJS.user.data&&(AEJSWP.debugOutput("AE user detected, adding AE handler back to any custom forms"),jQuery("#ae-cform-email-reg-"+e).attr("data-ae-register-form","email"),AEJSWP.aeJS.trigger.attach())},AEJSWP.displayVerifyEmail=function(e,t){jQuery("#ae-cform-verify-email-container-"+e).show();var r=jQuery("#ae-cform-verify-email-container-"+e+" > .ae-cform-verify-email-instructions").html(),o=r.replace("{USEREMAIL}",t);jQuery("#ae-cform-verify-email-container-"+e+" > .ae-cform-verify-email-instructions").html(o),jQuery("#ae-cform-mailing-list-success-"+e).hide(),jQuery("#ae-cform-title-"+e).hide(),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-email-container-"+e).hide(),jQuery("#ae-cform-optins-container-"+e).hide()},AEJSWP.sendVerifyEmail=function(e,t){var t=t||!1;AEJSWP.debugOutput("Triggering verify email send to "+e);var r={subject:AEJSWP.aeJS.settings.email_format.verify_email_subject,body:AEJSWP.aeJS.settings.email_format.verify_email_message,label:AEJSWP.aeJS.settings.email_format.verify_email_link},o=window.location.href;t&&(o=AEJSWP.addURLParameter(o,"password_reset",t)),AEJSWP.aeJS.trigger.send_verify_email(o,e,r)},AEJSWP.updateCustomForms=function(){AEJSWP.debugOutput("Updating custom form display states");var e=jQuery.fn.jquery.split(".");if(parseInt(e[0])<=1&&parseInt(e[1])<8&&(console.log("The version of jQuery on the page is too old for AE Connect custom forms, please upgrade to 1.8.x or better"),jQuery(".ae-cform-container").html("The loaded version of jQuery is too old. Please upgrade to 1.8.x or better.")),jQuery(".ae-cform-container").each(function(){var e=jQuery(this).data("ae-cform-id");"undefined"!=typeof AEJSWP.custom_forms[e].expanded_email&&0!=parseInt(AEJSWP.custom_forms[e].expanded_email)&&(AEJSWP.debugOutput("Custom form "+e+" is set to show email form"),AEJSWP.renderCaptcha(e),jQuery("#ae-cform-email-container-"+e).show(),1==Object.keys(AEJSWP.custom_forms[e].signin_options).length&&jQuery("#ae-cform-signin-options-"+e).hide())}),"undefined"!=typeof AEJSWP.aeJS&&"undefined"!=typeof AEJSWP.aeJS.user.data){var t=AEJSWP.aeJS.user.data;for(var r in AEJSWP.custom_forms){var o=AEJSWP.custom_forms[r].form_fields;for(var a in o){var s=o[a];switch(a){case"birthdate":var i=t[s];"undefined"!=typeof i&&null!==i&&10==i.length&&(jQuery(".ae-cform-item-"+a+" input[name=s_birthdate_day]").val(i.substring(8,10)),jQuery(".ae-cform-item-"+a+" input[name=s_birthdate_month]").val(i.substring(5,7)),jQuery(".ae-cform-item-"+a+" input[name=s_birthdate_year]").val(i.substring(0,4)));break;case"country":
"undefined"!=typeof t.CountryCode?jQuery("#ae-cform-input-reg-country-"+r).val(t.CountryCode):"undefined"!=typeof t.GeoCountry&&jQuery("#ae-cform-input-reg-country-"+r).val(t.GeoCountry);var n=jQuery("#ae-cform-input-reg-country-"+r).val(),u="1"==AEJSWP.custom_forms[r].opt_ins_casl_enabled;"CA"==n&&u&&(AEJSWP.debugOutput("CASL enabled & user is from Canada, updating opt-ins & terms for CASL compliance"),AEJSWP.updateCaslLabels(!0));break;default:jQuery(".ae-cform-item-"+a+" .ae-cform-input").val(AEJSWP.aeJS.user.data[s])}}}}AEJSWP.updateDOB(),AEJSWP.getSessionStorageItem("aejswp_cform_id")&&"undefined"!=typeof AEJSWP.aeJS&&"undefined"!=typeof AEJSWP.aeJS.user.data&&AEJSWP.hideCaptchaOnForm(AEJSWP.getSessionStorageItem("aejswp_cform_id")),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")&&!AEJSWP.userHasVerifiedEmail()&&AEJSWP.displayVerifyEmail(AEJSWP.getSessionStorageItem("aejswp_cform_id"),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")),AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id")&&AEJSWP.displayEnterNewPassword(),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")||""==AEJSWP.getQueryStringValue("password_reset")||AEJSWP.setSessionStorageItem("aejswp_password_reset_in_progress",!0),AEJSWP.restoreUserOptins();var d=AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0);if(d)for(var S=0;S<d.length;S++)AEJSWP.displayMailingListSuccess(d[S]);var l=AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)?AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0):[],r=AEJSWP.getSessionStorageItem("aejswp_cform_id");if(r&&l[r]){AEJSWP.debugOutput("Custom form flow still in progress and user has previously opened modal");var c=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[],p="undefined"!=c[r]&&"null"!=c[r]&&1==c[r];1==parseInt(AEJSWP.custom_forms[r].modal_display)&&(""!=AEJSWP.getQueryStringValue("password_reset")?AEJSWP.debugOutput("Not re-opening modal, password reset redirect in progress"):AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")?(AEJSWP.debugOutput("User returning from password reset, so re-opening modal"),jQuery("#ae-cform-modal-container-"+r).modal(),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")):p?AEJSWP.debugOutput("User previously clicked close on this custom from modal, so not re-opening automatically"):(AEJSWP.debugOutput("User has not closed the modal themseleves, so re-opening modal automatically"),jQuery("#ae-cform-modal-container-"+r).modal()))}else r&&1==parseInt(AEJSWP.custom_forms[r].modal_display)&&(AEJSWP.debugOutput("Custom form flow still in progress and custom form is using modal display, but user has not opened it yet"),AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")&&""!=!AEJSWP.getQueryStringValue("password_reset")&&(AEJSWP.debugOutput("Password reset in progress, so re-opening modal"),jQuery("#ae-cform-modal-container-"+r).modal(),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")))},AEJSWP.restoreUserOptins=function(){var e=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);if(e)for(var t=0;t<e.length;t++)null!=e[t]&&(AEJSWP.debugOutput("Restoring optin "+t+", user_choice = "+e[t]),jQuery('.ae-cform-optin-checkbox[data-ae-optin-id="'+t+'"]').prop("checked",e[t]))},AEJSWP.sendUserOptins=function(e,t,r){if(AEJSWP.disable_optins_hook)AEJSWP.debugOutput("optins hook disabled in performance settings");else{var o=AEJSWP.getUserUpdatedOptins(e,r);if(o){AEJSWP.debugOutput("Posting user + optin data for cform_id "+e);var a={action:AEJSWP.ajax_action_send_user_optins,cform_id:e,user_data:t,optins:o,confirm_code:"undefined"!=typeof AEJSWP.custom_forms[e].captcha_widget?grecaptcha.getResponse(AEJSWP.custom_forms[e].captcha_widget):""};AEJSWP.debugOutput("WP Update User Optins AJAX request : ",a),jQuery.post(AEJSWP.ajaxurl,a,function(r){try{if(r=jQuery.parseJSON(r),0==r.status)console.log("AEJSWP Error: Update User Optins AJAX response : ",r);else{AEJSWP.debugOutput("WP Update User Optins AJAX response : ",r),AEJSWP.removeSessionStorageItem("aejswp_initial_optin_choices");var a={cform_id:e,user_data:t,optins:o};AEJSWP.trackEvent("optinsUpdated",a)}}catch(e){console.log("AEJSWP Error: WP Update User Optins AJAX response : ",r)}})}else AEJSWP.debugOutput("User optins not changed, so not making backend post")}},AEJSWP.getUserUpdatedOptins=function(e,t){var r={},o=!1,a=AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0),s=AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0):[],i=(s[e],1!=s[e]);i&&(AEJSWP.debugOutput("First time user has completed this form, marking all optins for this cform as changed"),o=!0,s[e]=!0,AEJSWP.setLocalStorageItem("aejswp_first_optins_post_completed",s,!0));for(var n in t)"undefined"==a[n]||t[n].user_choice!=a[n]?(o=!0,r[n]=t[n]):i&&(o=!0,r[n]=t[n]);return!!o&&r},AEJSWP.getUserOptinChoices=function(e){AEJSWP.restoreUserOptins();var t=AEJSWP.custom_forms[e].opt_ins,r={};for(var o in t){t[o].user_choice=jQuery("#ac-cform-optin-checkbox-"+e+"-"+t[o].id).is(":checked"),r[o]={optin_id:t[o].id,user_choice:t[o].user_choice};var a=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);a[t[o].id]=t[o].user_choice,AEJSWP.setLocalStorageItem("aejswp_optin_choices",a,!0)}return r},AEJSWP.clearCustomFormState=function(e){doClearState=function(){AEJSWP.debugOutput("Custom Form flow ended, clearing state, immediate = "+e),AEJSWP.aeJS.settings.display_error_message=!0,AEJSWP.aeJS.settings.extra_fields_screen=AEJSWP.extra_fields_screen,AEJSWP.aeJS.settings.extra_fields=AEJSWP.extra_fields,AEJSWP.aeJS.settings.services=AEJSWP.services,AEJSWP.aeJS.settings.return_url=AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url"):AEJSWP.aeJS.settings.return_url,AEJSWP.aeJS.settings.auth_window=AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window"):AEJSWP.aeJS.settings.auth_window,AEJSWP.aeJS.settings.extra_fields=AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields",!0):AEJSWP.aeJS.settings.auth_window,AEJSWP.removeSessionStorageItem("aejswp_cform_id"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_return_url"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_auth_window"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_extra_fields"),AEJSWP.removeSessionStorageItem("aejswp_user_cancelled_cform_modal_display"),AEJSWP.removeSessionStorageItem("aejswp_user_opened_cform_modal_display"),AEJSWP.removeSessionStorageItem("aejswp_verify_email_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_verify_email_sent"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_email"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_member_service_id"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open"),AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress")},AEJSWP.getSessionStorageItem("aejswp_cform_id")&&(e?doClearState():setTimeout(doClearState,1))},AEJSWP.displayPasswordResetEmailSent=function(){var e=AEJSWP.getSessionStorageItem("aejswp_cform_id");jQuery("#ae-cform-reset-password-instruction-"+e).html(AEJSWP.custom_forms[e].flow_labels.reset_password_instructions_sent),jQuery("#ae-cform-reset-password-submit-"+e).hide(),jQuery("#ae-cform-reset-password-email-"+e).hide(),jQuery("#ae-cform-reset-password-login-link-"+e).hide()},AEJSWP.displayEnterNewPassword=function(){AEJSWP.debugOutput("Showing password reset step 2");var e=AEJSWP.getSessionStorageItem("aejswp_cform_id");jQuery("#ae-cform-email-container-"+e).hide(),jQuery("#ae-cform-title-"+e).hide(),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-reset-password-step1-"+e).hide(),jQuery("#ae-cform-reset-password-login-link-"+e).hide(),jQuery("#ae-cform-reset-password-step2-"+e).show(),jQuery("#ae-cform-reset-password-container-"+e).show(),jQuery("#ae-cform-optins-container-"+e).hide()},AEJSWP.displayPasswordResetSuccess=function(){AEJSWP.debugOutput("Showing password reset success");var e=AEJSWP.getSessionStorageItem("aejswp_cform_id");jQuery("#ae-cform-reset-password-step2-"+e).hide(),jQuery("#ae-cform-reset-password-step3-"+e).show(),jQuery("#ae-cform-reset-password-login-link-"+e).show()},AEJSWP.clearPasswordResetState=function(){AEJSWP.debugOutput("Clearing password reset state"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_email"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_member_service_id"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")},AEJSWP.updateCaslLabels=function(e){e?(jQuery(".ae-cform-optin-label-non-casl").hide(),jQuery(".ae-cform-optin-terms-non-casl").hide(),jQuery(".ae-cform-optin-label-casl").show(),jQuery(".ae-cform-optin-terms-casl").show(),jQuery(".ae-cform-optin-checkbox").attr("checked",!1)):(jQuery(".ae-cform-optin-label-non-casl").show(),jQuery(".ae-cform-optin-terms-non-casl").show(),jQuery(".ae-cform-optin-label-casl").hide(),jQuery(".ae-cform-optin-terms-casl").hide())},AEJSWP.displayRegistrationForm=function(e){jQuery("#ae-cform-email-login-container-"+e).slideToggle(),jQuery("#ae-cform-email-reg-container-"+e).slideToggle(),AEJSWP.renderCaptcha(e);var t=AEJSWP.custom_forms[e].modal_display_cta;AEJSWP.trackEvent("registrationModalShown",t)},AEJSWP.renderCaptcha=function(e){AEJSWP.custom_forms.captchaLoadComplete&&"undefined"==typeof AEJSWP.aeJS.user.data&&(AEJSWP.debugOutput("Looking for reCAPTCHAs to load."),"undefined"==typeof AEJSWP.custom_forms[e].captcha_widget&&jQuery("#ae-cform-captcha-"+e).length&&(AEJSWP.debugOutput("Custom form has reCAPTCHA element. Now rendering."),AEJSWP.custom_forms[e].captcha_widget=grecaptcha.render("ae-cform-captcha-"+e,{sitekey:AEJSWP.custom_forms[e].recaptcha_key,callback:AEJSWP.captchaVerifyCallback})))},AEJSWP.hideCaptchaOnForm=function(e){AEJSWP.debugOutput("Hiding captcha field on form "+e),jQuery("#ae-cform-captcha-"+e).hide()},AEJSWP.captchaVerifyCallback=function(){AEJSWP.debugOutput("Google reCAPTCHA: Calling for token check across custom forms."),jQuery.each(AEJSWP.custom_forms,function(e,t){AEJSWP.debugOutput("Google reCAPTCHA: Check form "+e),"undefined"==typeof AEJSWP.custom_forms[e].captcha_widget||AEJSWP.custom_forms[e].captchaVerified||(2==parseInt(AEJSWP.custom_forms[e].type_id)?(AEJSWP.debugOutput("Google reCAPTCHA completed, but deferring validation until form optins submitted"),AEJSWP.custom_forms[e].captchaVerified=!0):jQuery.ajax({url:AEJSWP.ajaxurl,method:"POST",type:"POST",dataType:"json",data:{action:AEJSWP.ajax_action_user_check_captcha,sitekey:AEJSWP.custom_forms[e].recaptcha_key,confirmcode:grecaptcha.getResponse(AEJSWP.custom_forms[e].captcha_widget),formid:e},success:function(t){AEJSWP.debugOutput("Google reCAPTCHA: Response "+t.success),1==t.success?(AEJSWP.debugOutput("Google reCAPTCHA: Custom form "+e+" validated"),AEJSWP.custom_forms[e].captchaVerified=!0):(AEJSWP.debugOutput("Google reCAPTCHA: failed (not validated)"),AEJSWP.custom_forms[e].captchaVerified=!1)},error:function(t,r,o){AEJSWP.debugOutput("Google reCAPTCHA: failed (AJAX Failed) "+r),AEJSWP.custom_forms[e].captchaVerified=!1}}))})};var onCaptchaloadCallback=function(){AEJSWP.debugOutput("Google reCAPTCHA script loaded correctly."),AEJSWP.custom_forms.captchaLoadComplete=!0};AEJSWP.addCustomFormListeners=function(){jQuery(".ae-cform-already-registered-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-login-container-"+t).slideToggle(),jQuery("#ae-cform-email-reg-container-"+t).slideToggle()}),jQuery(".ae-cform-not-registered-link").click(function(e){e.preventDefault(),AEJSWP.displayRegistrationForm(parseInt(jQuery(this).data("ae-cform-id")))}),jQuery(".ae-cform-forgot-password-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-container-"+t).slideToggle(),jQuery("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery("#ae-cform-title-"+t).slideUp(),jQuery("#ae-cform-signin-options-"+t).slideUp(),jQuery("#reset-password-email-"+t).val(jQuery("#ae-cform-input-login-email-"+t).val()),jQuery("#ae-cform-optins-container-"+t).slideUp()}),jQuery(".ae-cform-reset-password-login-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-container-"+t).slideToggle(),jQuery("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery("#ae-cform-title-"+t).slideDown(),jQuery("#ae-cform-signin-options-"+t).slideDown(),jQuery("#ae-cform-optins-container-"+t).slideDown()}),jQuery(".ae-cform-verify-email-resend-link").click(function(e){e.preventDefault(),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")&&AEJSWP.sendVerifyEmail(AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress"))}),jQuery(".ae-cform-reset-password-submit").click(function(e){AEJSWP.debugOutput("Password reset flow started"),e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id")),r=jQuery("#reset-password-email-"+t).val();AEJSWP.applyCustomFormSettings(t),AEJSWP.setSessionStorageItem("aejswp_password_reset_in_progress",!0),AEJSWP.sendVerifyEmail(r,t)}),jQuery(".ae-cform-update-password-submit").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id")),r=jQuery("#reset-password-password-"+t).val(),o=AEJSWP.getSessionStorageItem("aejswp_password_reset_email"),a=AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id");AEJSWP.debugOutput("Updating user password for:"+o+", member_service_id "+a),AEJSWP.aeJS.trigger.reset_password(a,o,r)}),jQuery(".ae-cform-optin-checkbox").change(function(){event.preventDefault();var e=parseInt(jQuery(this).data("ae-optin-id")),t=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);t[e]=jQuery(this).is(":checked"),AEJSWP.setLocalStorageItem("aejswp_optin_choices",t,!0)}),jQuery("input[name*='s_birthdate']").on("input",function(){AEJSWP.updateDOB()}),jQuery("input[name='s_birthdate_day'],input[name='s_birthdate_month']").on("blur",function(){var e=AEJSWP.padString(jQuery(this).val(),2);e!=jQuery(this).val()&&""!=jQuery(this).val()&&jQuery(this).val(e)}),jQuery(".ae-cform-input-country").change(function(){var e=jQuery(this).val(),t=parseInt(jQuery(this).data("ae-cform-id")),r="1"==AEJSWP.custom_forms[t].opt_ins_casl_enabled;if("CA"==e&&r){AEJSWP.debugOutput("CASL enabled & user selected Canada, updating opt-ins & terms for CASL compliance"),AEJSWP.updateCaslLabels(!0),AEJSWP.debugOutput("User completed CASL compliance flow, updating state");var o=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[];o[t]=!0,AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress"),AEJSWP.setLocalStorageItem("aejswp_user_casl_completed",o,!0)}"CA"!=e&&r&&(AEJSWP.debugOutput("CASL enabled, but user selected another country, updating opt-in terms for non-CASL"),AEJSWP.updateCaslLabels(!1))}),jQuery(".ae-cform-modal-display-cta").click(function(){var e=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-modal-container-"+e).modal();var t=AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)?AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0):[];t[e]=!0,AEJSWP.setSessionStorageItem("aejswp_user_opened_cform_modal_display",t,!0);var r=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[];r[e]=!1,AEJSWP.setSessionStorageItem("aejswp_user_cancelled_cform_modal_display",r,!0);var o=AEJSWP.custom_forms[e].modal_display_cta;AEJSWP.trackEvent("loginModalShown",o)}),"undefined"!=typeof jQuery.modal&&jQuery(".ae-cform-modal-container").on(jQuery.modal.OPEN,function(e,t){jQuery(".close-modal").click(function(){AEJSWP.debugOutput("Modal closed by user");var e=AEJSWP.getSessionStorageItem("aejswp_cform_id");if(e){var t=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[];t[e]=!0,AEJSWP.setSessionStorageItem("aejswp_user_cancelled_cform_modal_display",t,!0)}})})},AEJSWP.updateDOB=function(){var e=jQuery("input[name='s_birthdate_day']").val();"undefined"!=typeof e&&e.length>0&&(e=AEJSWP.padString(e,2));var t=jQuery("input[name='s_birthdate_month']").val();"undefined"!=typeof t&&t.length>0&&(t=AEJSWP.padString(t,2));var r=jQuery("input[name='s_birthdate_year']").val();jQuery("input[name='birthdate']").val(r+"-"+t+"-"+e)},AEJSWP.setFormError=function(e,t){jQuery(".ae-cform-error-block",e).html(t).show()},AEJSWP.hideFormError=function(e){jQuery(".ae-cform-error-block",e).hide()},AEJSWP.debugOutput=function(e,t){AEJSWP.debug&&("undefined"!=typeof t?console.log("AEJSWP: "+e,t):console.log("AEJSWP: "+e))},AEJSWP.debugOutput("AE Connect console logging enabled, disable debug in plugin settings to remove this output."),AEJSWP.getQueryStringValue=function(e){return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+escape(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},AEJSWP.removeURLParameter=function(e,t){var r=e.split("?");if(r.length>=2){for(var o=encodeURIComponent(t)+"=",a=r[1].split(/[&;]/g),s=a.length;s-- >0;)a[s].lastIndexOf(o,0)!==-1&&a.splice(s,1);return e=r[0]+(a.length>0?"?"+a.join("&"):"")}return e},AEJSWP.addURLParameter=function(e,t,r){return e.replace(new RegExp("([?&]"+t+"(?=[=&#]|$)[^#&]*|(?=#|$))"),"&"+t+"="+encodeURIComponent(r)).replace(/^([^?&]+)&/,"$1?")},AEJSWP.executeFunctionByName=function(e,t){for(var r=Array.prototype.slice.call(arguments,2),o=e.split("."),a=o.pop(),s=0;s<o.length;s++){if("undefined"==typeof t)return!1;t=t[o[s]]}return"undefined"!=typeof t&&"undefined"!=typeof t[a]&&t[a].apply(t,r)},AEJSWP.setSessionStorageItem=function(e,t,r){return"undefined"==typeof r&&(r=!1),"undefined"!=typeof Storage&&(r?sessionStorage.setItem(e,JSON.stringify(t)):sessionStorage.setItem(e,t),!0)},AEJSWP.getSessionStorageItem=function(e,t){if("undefined"==typeof t&&(t=!1),"undefined"!=typeof Storage){var r=sessionStorage.getItem(e);return r="true"==r||r,r="false"!=r&&r,t&&(r=JSON.parse(r)),r}return!1},AEJSWP.removeSessionStorageItem=function(e){return"undefined"!=typeof Storage&&(sessionStorage.removeItem(e),!0)},AEJSWP.setLocalStorageItem=function(e,t,r){return"undefined"==typeof r&&(r=!1),"undefined"!=typeof Storage&&(r?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t),!0)},AEJSWP.getLocalStorageItem=function(e,t){if("undefined"==typeof t&&(t=!1),"undefined"!=typeof Storage){var r=localStorage.getItem(e);return r="true"==r||r,r="false"!=r&&r,t&&(r=JSON.parse(r)),r}return!1},AEJSWP.removeLocalStorageItem=function(e){return"undefined"!=typeof Storage&&(localStorage.removeItem(e),!0)},AEJSWP.providerExistsInServices=function(e,t){for(var r in e){var o=e[r];if("undefined"!=typeof o.Service&&o.Service==t)return!0}return!1},AEJSWP.getLastLoginService=function(e){var t={},r="2000-01-01 00:00:00";for(var o in e){var a=e[o];"undefined"!=typeof a.Service&&"undefined"!=a.LastLogin&&a.LastLogin>r&&(t=a,r=a.LastLogin)}return t},AEJSWP.padString=function(e,t){return e=e.toString(),e.length<t?AEJSWP.padString("0"+e,t):e},AEJSWP.userHasVerifiedEmail=function(){return"undefined"!=typeof AEJSWP.aeJS.user.data&&"undefined"!=typeof AEJSWP.aeJS.user.data.VerifiedEmail&&""!=AEJSWP.aeJS.user.data.VerifiedEmail},AEJSWP.clearSessionStorage=function(){AEJSWP.debugOutput("Clearing all session storage"),AEJSWP.removeSessionStorageItem("aejswp_ae_login_fired"),AEJSWP.removeSessionStorageItem("aejswp_initial_optin_choices"),AEJSWP.removeSessionStorageItem("aewpjs_login_error_status_6_displayed"),AEJSWP.removeSessionStorageItem("aewpjs_sso_attempted"),AEJSWP.clearCustomFormState(!0)},AEJSWP.getCurrentState=function(){AEJSWP.debugOutput("CURRENT STATE >>"),AEJSWP.debugOutput("",AEJSWP),AEJSWP.debugOutput("aeJS",AEJSWP.aeJS),AEJSWP.debugOutput("user",AEJSWP.aeJS.user),AEJSWP.debugOutput("SessionStorage: aejswp_cform_id",AEJSWP.getSessionStorageItem("aejswp_cform_id")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_return_url",AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_auth_window",AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_extra_fields",AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields"),!0),AEJSWP.debugOutput("SessionStorage: aejswp_ae_login_fired",AEJSWP.getSessionStorageItem("aejswp_ae_login_fired")),AEJSWP.debugOutput("SessionStorage: aejswp_verify_email_in_progress",AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")),AEJSWP.debugOutput("SessionStorage: aejswp_verify_email_sent",AEJSWP.getSessionStorageItem("aejswp_verify_email_sent")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_in_progress",AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_email",AEJSWP.getSessionStorageItem("aejswp_password_reset_email")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_member_service_id",AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_force_modal_open",AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")),AEJSWP.debugOutput("SessionStorage: aejswp_user_casl_in_progress",AEJSWP.getSessionStorageItem("aejswp_user_casl_in_progress",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_initial_optin_choices",AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_user_cancelled_cform_modal_display",AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_user_opened_cform_modal_display",AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)),AEJSWP.debugOutput("SessionStorage: aewpjs_login_error_status_6_displayed",AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")),AEJSWP.debugOutput("SessionStorage: aewpjs_sso_attempted",AEJSWP.getSessionStorageItem("aewpjs_sso_attempted")),AEJSWP.debugOutput("LocalStorage: aejswp_user_casl_completed",AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)),AEJSWP.debugOutput("LocalStorage: aejswp_first_optins_post_completed",AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0)),AEJSWP.debugOutput("LocalStorage: aeswp_cform_mailing_lists_completed",AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0)),AEJSWP.debugOutput("LocalStorage: aejswp_optin_choices",AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0))},AEJSWP.resetAllState=function(){AEJSWP.debugOutput("Clearing all local storage"),AEJSWP.removeLocalStorageItem("aeswp_cform_mailing_lists_completed"),AEJSWP.removeLocalStorageItem("aejswp_optin_choices"),AEJSWP.removeLocalStorageItem("aejswp_user_casl_completed"),AEJSWP.removeLocalStorageItem("aejswp_first_optins_post_completed"),AEJSWP.logout()},AEJSWP.add_aejsready_handler=function(e){AEJSWP.debugOutput("Adding custom aejsready handler function : "+e),AEJSWP.aejsready_handlers.push(e)},AEJSWP.logout=function(){AEJSWP.clearSessionStorage();var e=AEJSWP.user_logged_in?AEJSWP.ae_logout_url_bare+"&return_url="+AEJSWP.wp_logout_url:AEJSWP.ae_logout_url;AEJSWP.debugOutput("Logout. Redirecting to AE logout handler : "+e),window.location.href=e},AEJSWP.get_user_country=function(e){var t=!1;return"undefined"!=typeof AEJSWP.aeJS&&Object.keys(AEJSWP.aeJS.user).length>0&&"undefined"!=typeof AEJSWP.aeJS.user.data&&"undefined"!=typeof AEJSWP.aeJS.user.data.CountryCode&&null!==AEJSWP.aeJS.user.data.CountryCode&&AEJSWP.aeJS.user.data.CountryCode.length>0?void AEJSWP.executeFunctionByName(e,window,AEJSWP.aeJS.user.data.CountryCode):void jQuery.ajax({type:"POST",method:"POST",url:AEJSWP.ajaxurl,data:{action:AEJSWP.ajax_action_user_get_country},success:function(t){AEJSWP.executeFunctionByName(e,window,t)}})};